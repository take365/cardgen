\# カードジェネレーター（MVP）設計まとめ \& 開発手順（Codex CLI向け）



---



\## 0. 目的 / コンセプト



\* \*\*目的\*\*: デジタルボードゲーム（ココフォリア、Board Game Arena 等）向けのカード画像を、登録不要・低学習コストで生成できるツール。

\* \*\*方針\*\*: 静的アセットを\*\*コンテナにバンドル\*\*して App Run β で配信。外部ストレージは当面不使用。

\* \*\*MVPスコープ\*\*: 「サンプル選択 → 自動初期配置 → ちょい調整 → 透過PNG保存」。



---



\## 1. 想定ユーザー / ユースケース



\* \*\*ユーザー\*\*: TRPG/ボドゲのプレイヤー・配信者・制作者（一般ユーザー想定）。

\* \*\*ユースケース\*\*:



&nbsp; \* プリセットの背景/枠/アイコン + 任意テキストで\*\*カード画像\*\*を即席生成。

&nbsp; \* 出力を PNG（透過対応）で保存し、ゲーム卓へインポート。



---



\## 2. 要件



\### 機能要件（MVP）



1\. サンプル素材選択（背景/枠/アイコン）

2\. 自動初期配置（背景cover、枠fit、アート中央上寄せ、アイコン右上整列、テキスト上中/下部）

3\. 微調整（ドラッグ移動・簡易スケール・簡易回転）

4\. テキスト入力（タイトル/本文）

5\. PNGエクスポート（透過、pixelRatio倍率）



\### 非機能要件



\* \*\*レスポンス\*\*: 即時プレビュー。

\* \*\*互換性\*\*: 最新Chrome/Edge/Firefox。

\* \*\*サイズ\*\*: コンテナイメージはできれば \*\*< 200MB\*\*、アセット総量 \*\*< 50MB\*\*。

\* \*\*可用性\*\*: 永続ストレージ前提なし（再起動で初期化）。

\* \*\*法務\*\*: 保存時に免責文を明示（ユーザー責任利用）。



---



\## 3. アーキテクチャ / 技術選定



\* \*\*配信\*\*: nginx（alpine）

\* \*\*フロント\*\*: 素の HTML/CSS/JS + \*\*Konva.js\*\*（ドラッグ/拡縮/回転/PNG書き出し）

\* \*\*サーバ\*\*: なし（純静的）

\* \*\*画像\*\*: 透過が必要な素材は PNG、写真/模様は WebP

\* \*\*フォント\*\*: システムUI + Noto Sans JP（CDN or 同梱）



---



\## 4. ディレクトリ構成（初期）



```

cardgen/

├─ Dockerfile

├─ nginx.conf

└─ public/

&nbsp;  ├─ index.html

&nbsp;  ├─ styles.css

&nbsp;  └─ assets/

&nbsp;     ├─ backgrounds/   # \*.webp（2〜4点）

&nbsp;     ├─ frames/        # \*.png（2〜4点：透過枠）

&nbsp;     └─ icons/         # \*.png（3〜10点：小アイコン）

```



> 目安：総容量 20〜50MB。将来拡張時は外部ストレージへ退避。



---



\## 5. UI 仕様（MVP）



\* \*\*レイアウト\*\*: 左パネル（素材/テキスト） + 右プレビュー（750×1050）

\* \*\*レイヤー\*\*: background → frame → art（将来: ユーザーアップロード想定） → icons → text

\* \*\*操作\*\*:



&nbsp; \* サムネクリックで適用

&nbsp; \* ドラッグ移動（アイコン/アート/テキスト）

&nbsp; \* スケール（ホイール or ハンドル）※MVPはホイール簡易でOK

&nbsp; \* 回転（Rトグル or Alt+ホイール）※MVPは省略可

\* \*\*自動配置\*\*:



&nbsp; \* 背景: cover。枠: キャンバスfit。

&nbsp; \* タイトル: 上部中央寄せ、幅W-64、フォント自動縮小。

&nbsp; \* 本文: 下部ボックス（左右32/下80px）

&nbsp; \* アイコン: 右上から縦積み（64px + 12px gap）

\* \*\*保存\*\*: `stage.toDataURL({ mimeType: 'image/png', pixelRatio: 2 })`



---



\## 6. 免責（保存時ポップアップ表示）



> この画像はアップロード/サンプル素材を合成したものです。素材の権利および第三者の権利侵害の有無について当サービスは保証しません。利用者の責任においてご利用ください。



---



\## 7. 主要ファイル（雛形）



\### 7.1 Dockerfile（nginx配信）



```dockerfile

FROM nginx:alpine

EXPOSE 8080

COPY nginx.conf /etc/nginx/conf.d/default.conf

COPY public/ /usr/share/nginx/html/

CMD \["nginx", "-g", "daemon off;"]

```



\### 7.2 nginx.conf（キャッシュ方針）



```nginx

server {

&nbsp; listen 8080;

&nbsp; server\_name \_;

&nbsp; root /usr/share/nginx/html;

&nbsp; index index.html;



&nbsp; location = /index.html {

&nbsp;   add\_header Cache-Control "no-cache";

&nbsp;   try\_files $uri /index.html;

&nbsp; }



&nbsp; location ~\* \\.(?:js|css|png|jpg|jpeg|webp|gif|svg|ico|woff2?)$ {

&nbsp;   add\_header Cache-Control "public, max-age=31536000, immutable";

&nbsp;   try\_files $uri =404;

&nbsp; }



&nbsp; location / { try\_files $uri /index.html; }

}

```



\### 7.3 public/index.html（骨組み）



\* ヘッダー: タイトル、`自動配置`、`PNG保存`

\* 左パネル: 背景/枠/アイコンのサムネ、テキスト入力（タイトル/本文）

\* 右: Konva ステージ（750×1050）

\* フッター: 免責文



> 実装は Codex CLI で、前回提示のサンプル骨組みを流用。



\### 7.4 public/styles.css（骨組み）



\* ダーク基調、2カラム、ステージは 750×1050 の枠線付き



---



\## 8. サイズ/品質の指針



\* 背景は WebP（80〜85% 品質）

\* 枠/アイコンは PNG（透過必須）

\* 出力は pixelRatio=2（1500×2100）でシャープに

\* Webフォント採用時は `document.fonts.ready` 待ち



---



\## 9. テンプレ設計（軽量）



```json

{

&nbsp; "canvas": { "w": 750, "h": 1050, "dpiScale": 2 },

&nbsp; "assets": {

&nbsp;   "background": "assets/backgrounds/bg1.webp",

&nbsp;   "frame": "assets/frames/frame1.png",

&nbsp;   "icons": \["assets/icons/sword.png"]

&nbsp; },

&nbsp; "text": {

&nbsp;   "title": "Flame Dagger",

&nbsp;   "body": "相手に2ダメージを与える…"

&nbsp; },

&nbsp; "style": {

&nbsp;   "fontTitle": "Noto Sans JP",

&nbsp;   "fontBody": "Noto Sans JP",

&nbsp;   "colors": { "title": "#fff", "body": "#eee" },

&nbsp;   "iconSize": 64,

&nbsp;   "padding": 24

&nbsp; }

}

```



---



\## 10. 開発手順（Codex CLI に渡す用）



1\. \*\*骨組み生成\*\*



&nbsp;  \* `public/index.html`/`styles.css` を作成

&nbsp;  \* Konva.js（CDN）を読み込み、`Stage` と `Layer` を初期化

2\. \*\*素材サムネ \& 反映\*\*



&nbsp;  \* `.thumbs img\[data-type]` のクリックで背景/枠/アイコンを各レイヤーに配置

&nbsp;  \* 背景は cover、枠は fit を実装

3\. \*\*自動配置\*\*



&nbsp;  \* タイトル位置を上部中央、本文を下部ボックスに

&nbsp;  \* アイコンは右上から 64px 縦積み（gap 12px）

4\. \*\*編集操作（MVP）\*\*



&nbsp;  \* `draggable: true` でアイコンとテキストを移動

&nbsp;  \* マウスホイールで選択オブジェクトの等比拡縮（最初はステージ全体でも可）

5\. \*\*PNG保存\*\*



&nbsp;  \* `stage.toDataURL({ mimeType: 'image/png', pixelRatio: 2 })` をアンカーDL

&nbsp;  \* 保存直前に免責ダイアログ（`confirm()`）

6\. \*\*Docker 化\*\*



&nbsp;  \* `Dockerfile`/`nginx.conf` を配置し、`docker build`/`docker run -p 8080:8080` で起動

7\. \*\*アセット投入\*\*



&nbsp;  \* `assets/` に背景/枠/アイコンを数点配置（総量 < 50MB）

8\. \*\*最終確認\*\*



&nbsp;  \* 背景→枠→アイコン→テキスト→自動配置→PNG保存の流れを通す



---



\## 11. 受け入れ基準（MVP完了条件）



\* \[ ] サンプル素材の選択ができる（背景/枠/アイコン）

\* \[ ] タイトル・本文の入力が反映される

\* \[ ] 自動配置がワンクリックで適用される

\* \[ ] ドラッグで主要要素が移動できる

\* \[ ] PNG（透過）を書き出せる（pixelRatio=2）

\* \[ ] 初回デプロイで App Run β 上から動作確認できる



---



\## 12. ローカル実行 \& デプロイ



\### ローカル



```bash

cd cardgen

docker build -t cardgen-mvp .

docker run --rm -p 8080:8080 cardgen-mvp

\# → http://localhost:8080

```



\### App Run β（想定）



\* 8080/tcp で待受

\* イメージをContainer Registryへ push → App Run から参照

\* 再起動で初期状態に戻る（永続ストレージなし想定）



---



\## 13. 将来拡張（参考）



\* 画像アップロード（透過PNGアート）

\* グリッド/ガイドスナップ、前面/背面、ロック/非表示、Undo/Redo

\* CSV/JSONから一括生成

\* 外部ストレージ（S3互換/Cloudinary）とCDN

\* テンプレ共有/配布（マーケット化）



---



以上。これをベースに Codex CLI へ「骨組み→自動配置→保存」までの\*\*実装タスク\*\*として投げれば、短時間でMVP到達可能です。



